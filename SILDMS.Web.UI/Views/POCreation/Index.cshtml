@{
    Layout = "~/Views/Shared/_AdminLteLayout.cshtml";
}
<style>

    .dbody {
       background-color:whitesmoke;
    }


    .font-weight-bold {
        font-weight: bold;
        color:darkgreen;

    }

    .w-100 {
        width: 100%;
    }

    .d-flex {
        display: flex;
    }

    .align-items-center {
        align-items: center;
    }

    .justify-content-center {
        justify-content: center;
    }
    .link_total_bm {
        color: black;
        font-weight: bold;
    }

        .link_total_bm :hover {
            color: #0091EA !important;
            font-weight: bold;
        }

    .link_within_bm {
        color: green;
        font-weight: bold;
    }

        .link_within_bm :hover {
            color: #0091EA;
            font-weight: bold;
        }

    .link_out_bm {
        color: firebrick;
        font-weight: bold;
    }

        .link_out_bm :hover {
            color: #0091EA;
            font-weight: bold;
        }

    .global-search {
        height: 34px;
    }

    .btn-round {
        border-radius: 17px;
    }

    .box.box-solid.box-primary > .box-header {
        text-align: center;
    }

    .table-header {
        background-color: #8aa4af !important;
        color: darkblue !important;
        font-size: 13px;
    }
    .tableVen-striped > tbody > tr:nth-of-type(odd) {
        background-color: rgba(23, 250, 132, 0.01);
    }

    .selected-row {
        background-color: #dff0d8; /* Light green color to indicate selection */
    }


</style>

<div class="box box-primary box-body" ng-controller="POCreationCtrl">
    <div class="box-header with-border bg-light-blue-gradient" style="height: 38px; border-radius: 5px;">
        <h2 class="box-title" style="font-family: math; font-weight: 500;">Purchase Order Preparation</h2>

        <div class="box-tools pull-right">
            <div class="col-lg-12 pull-right">
                <div class="btn-group pull-right" style="margin-left: 4px; margin-right: 4px;">
                    <button class="button-custom btn-warning" type="button" data-ng-click="toggleRefreshTable()" ng-disabled="btnRefresh">
                        <i class="fa fa-refresh" style="padding-right: 5px"></i> Refresh
                    </button>
                </div>

                <div class="btn-group pull-right" style="margin-left: 4px; margin-right: 4px;">
                    <button class="button-custom btn-primary" type="button" data-ng-click="SearchPO()" ng-disabled="btnSearch">
                        <i class="fa fa-search" style="padding-right: 5px"></i> Search
                    </button>
                </div>

                <div class="btn-group pull-right" style="margin-left: 4px; margin-right: 4px;">
                    <button class="button-custom btn-primary" type="button" data-ng-click="Post()" ng-disabled="btnSave">
                        <i class="fa fa-save" style="padding-right: 5px"></i> {{ VendorReq.VendorReqID ? 'Update' : 'Save' }}
                    </button>
                </div>

                <div class="btn-group pull-right" style="margin-left: 4px; margin-right: 4px;">
                    <button class="button-custom btn-danger" type="button" data-ng-click="Cancel()" ng-disabled="btnSave">
                        <i class="fa fa-close" style="padding-right: 5px"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>


    @*<div class="row" style="margin:1%;">
            <div class="col-md-2">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border" style="padding-top:5px;padding-bottom:5px">
                        <h3 class="box-title text-center" style="font-size: 110%;">{{dashBoardResult[0].ServiceCategoryName}}</h3>
                    </div>

                    <div class="dbody">
                        <div class="row justify-content-center align-items-center" style="height: 100%;">
                            <button id="dashBoardResult[1].ServiceCategoryID" ng-click="VendorSelect(dashBoardResult[0].ServiceCategoryID)" class="d-flex align-items-center justify-content-center w-100" style="border: none; background: none;">
                                <h3 class="description-header font-weight-bold">{{dashBoardResult[0].ServicesCategoryCount}}</h3>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-md-2">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border" style="padding-top:5px;padding-bottom:5px">
                        <h3 class="box-title text-center" style="font-size: 110%;">{{dashBoardResult[1].ServiceCategoryName}}</h3>
                    </div>

                    <div class="dbody">
                        <div class="row justify-content-center align-items-center" style="height: 100%;">
                            <button id="dashBoardResult[1].ServiceCategoryID" ng-click="VendorSelect(dashBoardResult[1].ServiceCategoryID)" class="d-flex align-items-center justify-content-center w-100" style="border: none; background: none;">
                                <h3 class="description-header font-weight-bold">{{dashBoardResult[1].ServicesCategoryCount}}</h3>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-md-2">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border" style="padding-top:5px;padding-bottom:5px">
                        <h3 class="box-title text-center" style="font-size: 110%;">{{dashBoardResult[2].ServiceCategoryName}}</h3>
                    </div>

                    <div class="dbody">
                        <div class="row justify-content-center align-items-center" style="height: 100%;">
                            <button id="dashBoardResult[1].ServiceCategoryID" ng-click="VendorSelect(dashBoardResult[2].ServiceCategoryID)" class="d-flex align-items-center justify-content-center w-100" style="border: none; background: none;">
                                <h3 class="description-header font-weight-bold">{{dashBoardResult[2].ServicesCategoryCount}}</h3>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border" style="padding-top:5px;padding-bottom:5px">
                        <h3 class="box-title text-center" style="font-size: 110%;">{{dashBoardResult[3].ServiceCategoryName}}</h3>
                    </div>

                    <div class="dbody">
                        <div class="row justify-content-center align-items-center" style="height: 100%;">
                            <button id="dashBoardResult[1].ServiceCategoryID" ng-click="VendorSelect(dashBoardResult[3].ServiceCategoryID)" class="d-flex align-items-center justify-content-center w-100" style="border: none; background: none;">
                                <h3 class="description-header font-weight-bold">{{dashBoardResult[3].ServicesCategoryCount}}</h3>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-md-2">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border" style="padding-top:5px;padding-bottom:5px">
                        <h4 class="box-title text-center" style="font-size: 110%;">{{dashBoardResult[4].ServiceCategoryName}}</h4>
                    </div>

                    <div class="dbody">
                        <div class="row justify-content-center align-items-center" style="height: 100%;">
                            <button id="dashBoardResult[1].ServiceCategoryID" ng-click="VendorSelect(dashBoardResult[4].ServiceCategoryID)" class="d-flex align-items-center justify-content-center w-100" style="border: none; background: none;">
                                <h3 class="description-header font-weight-bold">{{dashBoardResult[4].ServicesCategoryCount}}</h3>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-md-2">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border" style="padding-top:5px;padding-bottom:5px">
                        <h3 class="box-title text-center" style="font-size: 110%;">{{dashBoardResult[5].ServiceCategoryName}}</h3>
                    </div>

                    <div class="dbody">
                        <div class="row justify-content-center align-items-center" style="height: 100%;">
                            <button id="dashBoardResult[1].ServiceCategoryID" ng-click="VendorSelect(dashBoardResult[5].ServiceCategoryID)" class="d-flex align-items-center justify-content-center w-100" style="border: none; background: none;">
                                <h3 class="description-header font-weight-bold">{{dashBoardResult[5].ServicesCategoryCount}}</h3>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>*@

    <div class="row" style="margin: 1%; box-shadow: 2px 2px 5px #888888; padding: 5px 10px 5px 10px;" ng-if="CSClientDisplayedCollection.length > 0">
        <div class="row">


            <div class="row" style="padding: 11px; margin-right: 15px; margin-left: 15px;">
               <table st-table="CSClientDisplayedCollection" st-safe-src="CSClientList" style="width:100%;" class="table table-condensed table-bordered table-striped table-hover pnlView">
                    <thead>
                        <tr style="font-size: 15px;">
                            <th colspan="15" style="text-align: left; color: black; font-weight: 100; font-family: math; background: #ffffff; border: 1px solid #3003eb">
                                Client List
                            </th>
                        <tr style="background-color: #82b0c9; color: #010823; font-size: 11px;">
                            <th class="col-lg-3 col-md-3 col-sm-3" data-ng-click="sort('ClientName')">Client Name</th>
                            <th class="col-lg-2 col-md-2 col-sm-2" data-ng-click="sort('ClientReqNo')">Requisition ID</th>
                            <th class="col-lg-2 col-md-2 col-sm-2" data-ng-click="sort('WIInfoID')">WorkOrder ID</th>
                            <th class="col-lg-2 col-md-2 col-sm-2" data-ng-click="sort('RequisitionDate')">Requisition Date</th>

                            <th class="col-lg-1 col-md-1 col-sm-1">Action</th>
                        </tr>
                        @*<tr>
            <th><input st-search="ClientName" placeholder="Client Name" class="input-sm form-control" type="search" /></th>
            <th><input st-search="ClientReqNo" placeholder="Client Req.No" class="input-sm form-control" type="search" /></th>
        </tr>*@
                    </thead>
                    <tbody>
                        <tr ng-repeat="row in CSClientDisplayedCollection"
                            ng-class="{'selected-row': row.selected}"
                            ng-style="getRowStyle(row)">

                            <td class="hidden">{{row.ClientID}}</td>
                            @*<td class="col-lg-2 col-md-2 col-sm-2 text-left">{{row.VendorCSAprvID}}</td>*@
                            <td class="col-lg-3 col-md-3 col-sm-3 text-left">{{row.ClientName}}</td>
                            <td class="col-lg-2 col-md-2 col-sm-2 text-left">{{row.ClientReqID}}</td>
                            <td class="col-lg-2 col-md-2 col-sm-2 text-left">{{row.WIInfoID}}</td>
                            <td class="col-lg-2 col-md-2 col-sm-2 text-center">{{row.RequisitionDate}}</td>

                            <td>
                                <a class="btn col-center btn-sm btn-flat btn-success" ng-click="ClientSelect(row)">Select</a>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        @*<tr>
                                <td colspan="11" class="text-center"><div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div></td>
                            </tr>*@
                    </tfoot>
                </table>
            </div>
        </div>
    </div>


    <div class="row" style="margin: 1%; background-color: #f0f0f0; box-shadow: 2px 2px 5px #888888; padding: 5px 10px 5px 10px;" ng-if="CSVendorDisplayedCollection.length > 0">
        <div class="row">

            <div class="row" style="padding: 11px; margin-right: 15px; margin-left: 15px;">
                <table st-table="CSVendorDisplayedCollection" st-safe-src="CSVendorList" style="width:100%;" class="table table-condensed table-bordered table-striped table-hover pnlView">
                    <thead>
                        <tr style="font-size: 15px;">
                            <th colspan="15" style="text-align: left; color: black; font-weight: 100; font-family: math; background: #ffffff; border: 1px solid #3003eb">
                                Vendor List
                            </th>
                        </tr>
                        <tr style="background-color: #82b0c9; color: #010823; font-size: 11px;">

                            <th class="col-lg-1 col-md-1 col-sm-1" data-ng-click="sort('VendorName')">Vendor Name</th>
                            <th class="col-lg-1 col-md-1 col-sm-1" data-ng-click="sort('ContactNumber')">Contact Number</th>
                            <th class="col-lg-1 col-md-1 col-sm-1" data-ng-click="sort('ContactPerson')">Contact Person</th>

                            <th class="col-lg-1 col-md-1 col-sm-1" data-ng-click="sort('Email')">Email</th>
                            <th class="col-lg-1 col-md-1 col-sm-1" data-ng-click="sort('CurrentAddress')">Contact Address</th>

                            <th class="col-lg-1 col-md-1 col-sm-1" data-ng-click="sort('TolQnty')">Number of Items</th>
                            <th class="col-lg-1 col-md-1 col-sm-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="row in CSVendorDisplayedCollection" ng-cloak style="font-size:12px;">
                            <td class="hidden">{{row.index+1}}</td>
                            <td class="hidden">{{row.VendorCSAprvID}}</td>
                            <td class="hidden">{{row.VendorID}}</td>
                            <td class="col-lg-3 col-md-2 col-sm-3 text-center">{{row.VendorName}}</td>
                            <td class="col-lg-1 col-md-2 col-sm-1 text-center">{{row.ContactPerson}}</td>
                            <td class="col-lg-1 col-md-1 col-sm-1 text-center">{{row.ContactNumber}}</td>
                            <td class="col-lg-2 col-md-2 col-sm-2 text-center">{{row.Email}}</td>
                            <td class="col-lg-2 col-md-1 col-sm-2 text-center">{{row.CurrentAddress}}</td>
                            <td class="col-lg-1 col-md-1 col-sm-1 text-center">{{row.ItemCount}}</td>
                            <td class="col-lg-2" style="width:5%;">
                                <button type="button" class="ChildButtons" ng-click="selectEntity(row)" data-dismiss="modal" title="Select">
                                    <i ng-show="!row.buttonCheckedforVendor" class="fa fa-square-o"></i>
                                    <i ng-show="row.buttonCheckedforVendor" class="fa fa-check-square-o"></i>
                                </button>
                                @*<button type="button" class="btn col-center btn-sm btn-flat btn-success" data-ng-click="ItemSelect(row)">Details</button>*@
                            </td>

                        </tr>
                    </tbody>
                    <tfoot>
                        @*<tr>
                                <td colspan="11" class="text-center"><div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div></td>
                            </tr>*@
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    <div class="row" ng-show="SelectedVendorForBiddingDisplayedCollection.length > 0">

        <div class="row" style="margin: 1%; background-color: #f0f0f0; box-shadow: 2px 2px 5px #888888; padding: 5px 10px 5px 10px;">
            <div class="row">
                <div class="row" style="padding: 11px; margin-right: 15px; margin-left: 15px;">
                    <table st-table="VenCSItemGridDisplayCollection" st-safe-src="VenCSItemList" style="width:100%;" class="table table-condensed table-bordered table-striped table-hover pnlView">
                        <thead>
                            <tr style="font-size: 15px;">
                                <th colspan="16" style="text-align: left; color: black; font-weight: 100; font-family: math; background: #ffffff; border: 1px solid #3003eb">
                                    Item List
                                </th>
                            </tr>
                            <tr style="background-color: #82b0c9; color: #010823; font-size: 11px;">

                                <th style="text-align: left;" st-sort="">Item Name</th>
                                <th style="text-align: left;" st-sort="">ReqQnty</th>
                                <th style="text-align: left;" st-sort="">RemainingQnty</th>
                                <th style="text-align: left;" st-sort="">RemainingVendorQnty</th>
                                <th style="text-align: left;" st-sort="">ReqUnit</th>
                                <th style="text-align: left;" st-sort="">QutnQnty</th>
                                <th style="text-align: left;" st-sort="">POQnty</th>

                                <th style="text-align: left;" st-sort="">QutnPrice</th>
                                <th style="text-align: left;" st-sort="">PoPrice</th>
                                <th style="text-align: left;" st-sort="">QutnAmt</th>
                                <th style="text-align: left;" st-sort="">PoAmt</th>
                                <th style="text-align: left;" st-sort="">VatPerc</th>
                                <th style="text-align: left;" st-sort="">VatAmt</th>
                                <th style="text-align: left;" st-sort="">PoVatAmt</th>
                                <th style="text-align: left;" st-sort="">TolAmt</th>
                                <th style="text-align: left;" st-sort="">PoTotalAmt</th>
                                @*<th style="text-align: left;">Action</th>*@
                            </tr>
                            @*<tr>
            <th colspan="5"><input st-search="" placeholder="Search" class="input-sm form-control" type="search" /></th>
        </tr>*@
                        </thead>
                        <tbody>
                            <tr ng-repeat="row in VenCSItemGridDisplayCollection" ng-cloak style="font-size:12px;">
                                <td class="hidden">{{row.index+1}}</td>
                                <td class="hidden">{{row.VendorCSInfoItemID}}</td>
                                <td class="hidden">{{row.VendorCSInfoID}}</td>
                                @*<td class="col-lg-1">{{ row.ServiceItemID }} </td>*@
                                <td class="col-lg-1">{{row.ServiceItemName}}</td>

                                <td class="col-lg-1">{{row.ReqQnty | number:2}}</td>
                                <td class="col-lg-1">{{row.RemainingQty}}</td>
                                <td class="col-lg-1">{{row.RemainingVendorQty}}</td>
                                <td class="col-lg-1">{{row.ReqUnit}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">{{row.QutnQnty | number:2}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">
                                    <input class="form-control" style="width:100%; height:18px;font-size:10px" type="text" min="0" ng-model="row.NegoQty" ng-blur="validateNegoQty(row)" ng-value="0" />
                                </td>

                                <td class="col-lg-1 col-md-1 col-sm-1">{{row.QutnPrice | number:2}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">
                                    <input class="form-control" style="width:100%; height:18px;font-size:10px" type="text" min="0" ng-model="row.NegoPrice" ng-blur="checkUnitPrice(row)" ng-value="0" />
                                </td>
                                <td class="col-lg-1 col-md-1 col-sm-1">{{row.QutnAmt| number:2}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">
                                    <input class="form-control" style="width:100%; height:18px;font-size:10px" type="text" min="0" ng-model="row.NegoAmt" ng-value="0" ng-readonly="true" />
                                </td>
                                <td class="col-lg-1 col-md-1 col-sm-1" style="width:3%;">{{row.VatPerc | number:2}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">{{row.VatAmt | number:2}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">
                                    <input class="form-control" style="width:100%; height:18px;font-size:10px" type="text" min="0" ng-model="row.NegoVatAmt" ng-value="0" ng-readonly="true" />
                                </td>
                                <td class="col-lg-1 col-md-1 col-sm-1">{{row.TolAmt | number:2}}</td>
                                <td class="col-lg-1 col-md-1 col-sm-1">
                                    <input class="form-control" style="width:100%; height:18px;font-size:10px"
                                           type="text" min="0"
                                           ng-model="row.NegoTolAmt"
                                           ng-readonly="true" />
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="11" class="text-center"><div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-1 col-md-1 col-lg-1">
            </div>
            <div class="col-lg-2">

            </div>
            <div class="col-lg-3">

            </div>

        </div>

        <div class="row">
            <div class="col-sm-1 col-md-1 col-lg-1">
            </div>
            <div class="col-lg-2">
                <div class="form-group">
                    <label>PO Date</label>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <input id="CSRecDate" name="CSRecDate" type="text" class="DatePicker form-control" placeholder="PO Date" ng-model="VendorCSInfo.CSRecDate" />
                </div>
            </div>

            <div class="col-lg-2">
                <div class="form-group">
                    <label>Bill Category:</label>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <label>
                        <input type="radio" ng-model="VendorCSInfo.Category" value="Normal" /> Normal
                    </label>
                    <label>
                        <input type="radio" ng-model="VendorCSInfo.Category" value="PlusMinus" /> Plus Minus
                    </label>
                </div>
            </div>








        </div>

        <div class="row">
            <div class="col-sm-1 col-md-1 col-lg-1">
            </div>
            <div class="col-lg-2">
                <div class="form-group">
                    <label>PO Amount:</label>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <input id="POAmount" name="POAmount" type="text" class="form-control" placeholder="PO Amount" ng-model="VendorCSInfo.PoAmount" ng-blur="calculateInstallmentAmount()" />
                </div>
            </div>




            <div class="col-lg-2">
                <div class="form-group">
                    <label>Bill Type:</label>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <label>
                        <input type="radio" ng-model="VendorCSInfo.BillType" value="Default" /> Default
                    </label>
                    <label>
                        <input type="radio" ng-model="VendorCSInfo.BillType" value="Installment" /> Installment
                    </label>
                </div>
            </div>















        </div>
        <div class="row">
            <div class="col-sm-1 col-md-1 col-lg-1">
            </div>
            <div class="col-lg-2" ng-show="VendorCSInfo.BillType === 'Installment'">
                <div class="form-group">
                    <label>Installment:</label>
                </div>
            </div>
            <div class="col-lg-3" ng-show="VendorCSInfo.BillType === 'Installment'">
                <div class="form-group">
                    <input id="Installment" name="Installment" type="text" class="form-control" placeholder="Number of Installment" ng-model="VendorCSInfo.Installment" ng-blur="calculateInstallmentAmount()" />
                </div>
            </div>

            <div class="col-lg-2" ng-show="VendorCSInfo.BillType === 'Installment'">
                <div class="form-group">
                    <label>Installment Amount:</label>
                </div>
            </div>
            <div class="col-lg-3" ng-show="VendorCSInfo.BillType === 'Installment'">
                <div class="form-group">
                    <input id="InstalledAmount" name="InstalledAmount" type="text" class="form-control" placeholder="Installed Amount" ng-model="VendorCSInfo.InstalledAmount" />
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-1 col-md-1 col-lg-1">
            </div>
            <div class="col-lg-2">
                <div class="form-group">
                    <label for="QuotationFor">Note:</label>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="form-group">
                    <input id="Remarks" name="Remarks" type="text" data-ng-model="VendorCSInfo.Remarks" class="form-control" placeholder="Note for PO" />
                </div>
            </div>
        </div>



        <div class="row" style="margin: 1%; background-color: #f0f0f0; box-shadow: 2px 2px 5px #888888; padding: 5px 10px 5px 10px;">
            <div class="row">
                <div class="row" style="padding: 11px; margin-right: 15px; margin-left: 15px;">
                   <table st-table="ReqTermGridDisplayCollection" st-safe-src="ReqTermDataSetupGridData" class="table table-condensed table-bordered table-striped table-hover pnlView" style="width:100%;">
                        <thead>
                            <tr style="font-size: 15px;">
                                <th colspan="15" style="text-align: left; color: black; font-weight: 100; font-family: math; background: #ffffff; border: 1px solid #3003eb">
                                    Terms List
                                </th>
                            </tr>
                            <tr style="background-color: #82b0c9; color: #010823; font-size: 11px;">
                                <th style="text-align: left;" st-sort="">Vendor Name</th>
                                <th style="text-align: left;" st-sort="">Terms Code</th>
                                <th style="text-align: left;" st-sort="">Terms & Conditions</th>

                            </tr>
                            @*<tr>
            <th colspan="5"><input st-search="" placeholder="Search" class="input-sm form-control" type="search" /></th>
        </tr>*@
                        </thead>
                        <tbody>
                            <tr ng-repeat="row in ReqTermGridDisplayCollection" ng-cloak style="font-size:12px;">
                                @*<td class="hidden">{{row.VendorCSInfoTermsID}}</td>
                                    <td class="hidden">{{row.VendorCSInfoID}}</td>*@
                                @*<td class="hidden">{{row.TermsID}}</td>*@
                                <td class="col-lg-1">{{row.VendorName}}</td>
                                <td class="col-lg-1">{{row.TermsCode}}</td>
                                <td class="col-lg-1">{{row.TermsName}}</td>

                                @*<td class="col-lg-1" style="width:5%;">
                                        <button type="button" ng-if="row.VendorCSInfoTermsID" class="btn btn-xs btn-primary btn-flat btnEdit" data-ng-click="toggleReqTermEdit(row,$index)"><i class="fa fa-edit"></i> </button>
                                        <button type="button" ng-if="!row.VendorCSInfoTermsID" class="btn btn-xs btn-primary btn-flat btnEdit" data-ng-click="toggleReqTermEdit(row,$index)"><i class="fa fa-edit"></i> </button>
                                        <button type="button" class="btn btn-xs btn-primary btn-flat btnDelete" data-ng-click="toggleReqTermDelete(row,$index)"><i class="fa fa-remove"></i> </button>
                                    </td>*@
                            </tr>
                        </tbody>
                        <tfoot>
                            @*<tr>
                                    <td colspan="11" class="text-center"><div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div></td>
                                </tr>*@
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="SearchModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div style="text-align: right;">
                    <button type="button" class="btn-danger" data-dismiss="modal" ng-click="ResetSearchModel()"
                            aria-hidden="true" style="color: #ffffff;">
                        <i class="fa fa-remove"></i>
                    </button>
                </div>
       
                <div class="table-responsive" data-ng-disabled="" ng-cloak>
                    <table st-table="SearchPOListCollection" st-safe-src="SearchPOList" style="width:100%" class="tableVen table-condensed table-bordered  table-hover pnlView">
                        <thead>
                            <tr style="font-size: 15px;">
                                <th colspan="12" style="text-align: left; color: black; font-weight: 100; font-family: math; background: #ffffff; border: 1px solid #3003eb">
                                    Material List
                                </th>
                            </tr>
                            <tr style="background-color: #82b0c9; color: #010823; font-size: 11px;">

                                <th class="col-lg-1 col-md-1 col-sm-1"> Number</th>
                                <th class="col-lg-1 col-md-1 col-sm-1">Po PreparationNo</th>
                                <th class="col-lg-3 col-md-3 col-sm-2">Client Requisition Number</th>
                                <th class="col-lg-2 col-md-2 col-sm-2">Vendor Code</th>
                                <th class="col-lg-3 col-md-3 col-sm-3">Vendor Name</th>
                                <th class="col-lg-2 col-md-2 col-sm-2">PO Date</th>

                                <th class="col-lg-1 col-md-1 col-sm-1">Action</th>
                            </tr>
                            <tr>
                                <th></th>
                                <th><input st-search="Material_Name" placeholder="Material Name" class="input-sm form-control" type="search" /></th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr ng-repeat="row in SearchPOListCollection">
                                <td class="text-center">{{$index+1}}</td>
                                <td class="text-center">{{row.PoPreparationID}}</td>
                                <td class="">{{row.ClientReqID}}</td>
                                <td class="">{{row.VendorID}}</td>
                                <td class="">{{row.VendorName}}</td>
                                <td class="">{{row.PoDate}}</td>

                                <td class="text-center">
                                    <a class="btn col-center btn-sm btn-flat btn-success" data-ng-click="toggleCSSelect(row)">Select</a>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="9" class="text-center"><div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div></td>
                            </tr>
                        </tfoot>

                    </table>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>





    <div id="ItemDetailsModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" ng-click="ResetSearchModel()" aria-hidden="true">x</button>
                    <h3 class="modal-title">Item Details</h3>
                </div>
                <div class="row" style="margin: 1%; background-color: #f0f0f0; box-shadow: 2px 2px 5px #888888; padding: 5px 10px 5px 10px;">
                    <div class="row">
                        <div class="row" style="padding: 11px; margin-right: 15px; margin-left: 15px;">
                            <table st-table="VenCSItemGridDisplayCollection" st-safe-src="VenCSItemList" class="table table-condensed table-bordered table-striped table-hover pnlView">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;" st-sort="">Item Code</th>
                                        <th style="text-align: left;" st-sort="">Item Name</th>
                                        <th style="text-align: left;" st-sort="">ReqQnty</th>
                                        <th style="text-align: left;" st-sort="">ReqUnit</th>
                                        <th style="text-align: left;" st-sort="">QutnQnty</th>
                                        <th style="text-align: left;" st-sort="">QutnPrice</th>
                                        <th style="text-align: left;" st-sort="">QutnAmt</th>
                                        <th style="text-align: left;" st-sort="">VatPerc</th>
                                        <th style="text-align: left;" st-sort="">VatAmt</th>
                                        <th style="text-align: left;" st-sort="">TolAmt</th>

                                        @*<th style="text-align: left;">Action</th>*@
                                    </tr>
                                    @*<tr>
                                            <th colspan="5"><input st-search="" placeholder="Search" class="input-sm form-control" type="search" /></th>
                                        </tr>*@
                                </thead>
                                <tbody>
                                    <tr ng-repeat="row in VenCSItemGridDisplayCollection" ng-cloak style="font-size:12px;">
                                        <td class="hidden">{{row.index+1}}</td>
                                        <td class="hidden">{{row.VendorCSInfoItemID}}</td>
                                        <td class="hidden">{{row.VendorCSInfoID}}</td>
                                        <td class="col-lg-1" style="width:5%;">{{ row.ServiceItemID }} </td>
                                        <td class="col-lg-1" style="width:5%;">{{row.ServiceItemName}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.ReqQnty | number:2}}</td>
                                        <td class="col-lg-1" style="width:5%;">{{row.ReqUnit}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.QutnQnty}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.QutnPrice}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.QutnAmt}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.VatPerc}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.VatAmt}}</td>
                                        <td class="col-lg-1" style="width:6%;">{{row.TolAmt}}</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    @*<tr>
                                            <td colspan="11" class="text-center"><div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div></td>
                                        </tr>*@
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="form-group">
                            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="ResetSearchModel()">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>








</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script type="text/javascript">

    app.controller('POCreationCtrl', ['$scope', '$http', '$timeout', function ($scope, $http, $timeout) {

        $scope.vendorCSItemArray = [];
        $scope.vendorCSTermArray = [];
        $scope.itemsByPage = 10;

        $scope.dashBoardResult = {};

        //$http.get('/POCreation/GetPOCreationDashBordData')
        //    .success(function (response) {
        //        $scope.loading = false;
        //        $scope.dashBoardResult = response.result;
        //    }).error(function () { });



            $http.post("/POCreation/GetPoCreationClientInfo/")
                .success(function (response) {
                    $scope.CSClientList = response.CSClientList;
                    $scope.CSClientDisplayedCollection = [].concat($scope.CSClientList);
                })
                .error(function () { });


        //$scope.ClientSelect = function (row) {
        //    $scope.VendorCSInfo.ClientID = row.ClientID;
        //    $scope.VendorCSInfo.ClientReqID = row.ClientReqID;
        //    $scope.VendorCSInfo.ServiceCategoryID = $scope.ServiceCategoryID;
        //    $scope.VendorCSInfo.VendorCSAprvID = row.VendorCSAprvID;
        //    $http.post("/POCreation/OBS_GetPOVendorsUsingClient", {
        //        ClientID: row.ClientID,
        //        VendorCSAprvID: row.VendorCSAprvID,
        //        ServiceCategoryID: $scope.ServiceCategoryID
        //    })
        //        .success(function (response) {
        //            $scope.CSVendorList = response.CSVendorList;
        //            $scope.CSVendorDisplayedCollection = [].concat($scope.CSVendorList);
        //            $scope.CSVendorDisplayedCollection.forEach(function (item, index) {
        //                // Add an index field to each object
        //                item.index = index; // Adding 1 to start index from 1
        //            });
        //        })
        //        .error(function () { });
        //};



        $scope.selectedRow = null; // Track the currently selected row

        $scope.ClientSelect = function (row) {
            // If the row is already selected, unselect it
            if (row.selected) {

                $scope.CSVendorList = [];
                $scope.CSVendorDisplayedCollection = [];
                $scope.VenCSItemGridDisplayCollection = [];
                row.selected = false;
                $scope.selectedRow = null;
            } else {
                // Unselect any previously selected row
                if ($scope.selectedRow) {

                    $scope.selectedRow.selected = false;
                }

                // Set the new row as selected
                row.selected = true;
                $scope.selectedRow = row;

                // Update the VendorCSInfo fields
                $scope.VendorCSInfo.ClientID = row.ClientID;
                $scope.VendorCSInfo.ClientReqID = row.ClientReqID;

                //$scope.VendorCSInfo.ServiceCategoryID = $scope.ServiceCategoryID;
                //$scope.VendorCSInfo.VendorCSAprvID = row.VendorCSAprvID;

                // Perform the HTTP request
                $http.post("/POCreation/OBS_GetPOVendorsUsingClient", {
                    ClientReqID: row.ClientReqID,
                    WIInfoID: row.WIInfoID
                    //VendorCSAprvID: row.VendorCSAprvID,
                    //ServiceCategoryID: $scope.ServiceCategoryID
                })
                    .then(function (response) {
                        $scope.CSVendorList = response.data.CSVendorList;
                        $scope.CSVendorDisplayedCollection = [].concat($scope.CSVendorList);
                    })
                    .catch(function () {
                        console.error("Error fetching vendor data.");
                    });
            }
        };



        $scope.getRowStyle = function (row) {
            if (row.selected) {
                return { background: '#8bf5d2' }; // Change this to your desired color
            } else {
                return {}; // No additional styling
            }
        };




        //$scope.ItemSelect = function (row) {

        //    $http.post("/POCreation/GetVendorPOQuotationItem", {
        //        VendorID: row.VendorID,
        //        ClientID: row.ClientID,
        //        ServiceCategoryID: $scope.ServiceCategoryID,
        //        VendorCSAprvID: row.VendorCSAprvID
        //    })
        //        .success(function (response) {
        //            $scope.VenCSItemList = response.VenCSItemList;
        //            $scope.VenCSItemGridDisplayCollection = [].concat($scope.VenCSItemList);
        //            console.log($scope.VenCSItemGridDisplayCollection);
        //        })
        //            .error(function () {
        //                $scope.loading = false;
        //            });



        //    /*$('#ItemDetailsModal').modal('show');*/
        //};

        $scope.VendorCSInfo = {
            VendorCSAprvID: "",
            VendorID: "",
            VendorName: "",
            ClientID: "",
            AutoCSNo: "",
            CSRecDate: "",
            Operation: "",
            RecommendedBy: "",
            Remarks: "",
            Status: "",
            PoAmount: "",
            ServiceCategoryID: "",
            ClientReqID: "",
            WIInfoID: "",
            BillType: "",
            Installment: 1,
            InstalledAmount: "",
            Category:""
        }

        $scope.VendorCSInfo.Category = 'Normal'; 
        $scope.VendorCSInfo.BillType = 'Default'; 

        $scope.VendorCSInfoItem = {
            VendorCSInfoItemID: "",
            ServiceCategory: { ServiceCategoryID: "", ServiceCategoryName: "" },
            ServiceItem: { ServiceItemID: "", ServiceItemName: "" },
            ReqQnty: "",
            ReqUnit: "",
            QutnQnty: "",
            QutnPrice: "",
            QutnUnit: "",
            QutnAmt: "",
            VatPerc: "",
            VatAmt: "",
            TolAmt: ""
        }

        $scope.VendorCSVendorsItemWise = {
            VendorCSVendorsItemWiseID: "",
            VendorCSInfoID: "",
            VendorCSInfoItemID: "",
            VendorID: "",
            VendorName: "",
            TolQnty: "",
            VendorQutnID: "",
            //ContactPerson: "",
            //ContactNumber: "",
            //VendorTINNo: "",
            //VendorBINNo: "",
            //VendorEmail: "",
            //VendorAddress: "",
            //VenReqQnty: "",
            //VenReqUnit: "",
            Status: ""
        }

        $('.DatePicker').datepicker({
            format: "dd/mm/yyyy",
            autoclose: true
            // Set minDate to 0 to disable selecting previous dates
        });

        $('.DatePicker')
            .on('changeDate', function (ev) {
                $('.datepicker').hide();
            });

        // ################# Detail Add Modal ####################
        $scope.AddReqItemModal = function () {

            if ($('#RequisitionNo').val() == "") {
                toastr.error("Vendor ReqNo.  Required");
                return;
            }

            if ($('#SubmissionDate').val() == "") {
                toastr.error("Submission Date Required.");
                return;
            }

            if ($('#RequisitionDate').val() == "") {
                toastr.error("Requisition Date Date Required");
                return;
            }
            $('#RequisitionItemModal').modal('show');
        };

        $scope.VenCSItemList = [];  // base collection
        $scope.VenCSItemGridDisplayCollection = [].concat($scope.VenCSItemList);

        $scope.AddReqItem = function () {

            if ($scope.VendorCSInfoItem.ServiceCategory.ServiceCategoryID == "") {
                toastr.error("Service Category Required");
                return;
            }

            if ($scope.VendorCSInfoItem.ServiceItem.ServiceItemID == "") {
                toastr.error("Service Item  Required");
                return;
            }

            if ($scope.VendorCSInfoItem.DeliveryMode == "") {
                toastr.error("Submission Date Required.");
                return;
            }

            if ($scope.VendorCSInfoItem.ReqUnit == "") {
                toastr.error("Requisition Date Date Required");
                return;
            }

            if ($('#DeliveryLocation').val() == "") {
                toastr.error("Service Category Required");
                return;
            }

            if ($('#DeliveryDate').val() == "") {
                toastr.error("Service Item  Required");
                return;
            }

            if ($('#Description').val() == "") {
                toastr.error("Submission Date Required.");
                return;
            }

            if ($('#ReqQnty').val() == "") {
                toastr.error("Requisition Date Date Required");
                return;
            }

            $scope.VendorCSInfoItem.ServiceCategoryID = $scope.VendorCSInfoItem.ServiceCategory.ServiceCategoryID;
            $scope.VendorCSInfoItem.ServiceCategoryName = $scope.VendorCSInfoItem.ServiceCategory.ServiceCategoryName;
            $scope.VendorCSInfoItem.ServiceItemID = $scope.VendorCSInfoItem.ServiceItem.ServiceItemID;
            $scope.VendorCSInfoItem.ServiceItemName = $scope.VendorCSInfoItem.ServiceItem.ServiceItemName;

            $scope.VendorCSInfoItem.DeliveryMode = $scope.VendorCSInfoItem.DeliveryMode;
            $scope.VendorCSInfoItem.ReqUnit = $scope.VendorCSInfoItem.ReqUnit;

            $scope.VendorCSInfoItem.DeliveryLocation = $('#DeliveryLocation').val();
            $scope.VendorCSInfoItem.DeliveryDate = $('#DeliveryDate').val();
            $scope.VendorCSInfoItem.Description = $('#Description').val();
            $scope.VendorCSInfoItem.ReqQnty = $('#ReqQnty').val();

            $scope.vendorCSItemArray.push($scope.VendorCSInfoItem);

            $scope.VenCSItemGridDisplayCollection = $scope.VenCSItemGridDisplayCollection.concat($scope.VendorCSInfoItem);

            $scope.resetVendorCSInfoItem();
            $("#btnAddReqItem").html('Add');
            $('#RequisitionItemModal').modal('hide');
        }

        $scope.resetVendorCSInfoItem = function () {
            $('#DeliveryDate').val('');
            $scope.VendorCSInfoItem = {
                VendorCSInfoItemID: "",
                VendorCSInfoID: "",
                ServiceCategory: { ServiceCategoryID: "", ServiceCategoryName: "" },
                ServiceItem: { ServiceItemID: "", ServiceItemName: "" },
                Description: "",
                DeliveryLocation: "",
                DeliveryDate: "",
                DeliveryMode: "",
                ReqQnty: "",
                ReqUnit: ""
            }
        }


        $scope.toggleClientReqSelect = function (tableRow) {
            $scope.VendorCSInfo.ClientReqID = tableRow.ClientReqID;
            $scope.VendorCSInfo.ClientID = tableRow.ClientID;
            $scope.VendorCSInfo.ClientName = tableRow.ClientName;
            $http.post('/ClientRequisition/GetClientReqItemList', { ClientReqID: tableRow.ClientReqID })
                .success(function (response) {
                    $scope.VenCSItemList = response.ClientReqItemList;
                    $scope.VenCSItemGridDisplayCollection = [].concat($scope.VenCSItemList);
                    $scope.VenCSItemGridDisplayCollection.forEach(function (item, index) {
                        // Add an index field to each object
                        item.index = index;
                  // Adding 1 to start index from 1
                    });
                    $scope.loading = false;
                }).error(function () {
                    $scope.loading = false;
                });

            $http.post('/ClientRequisition/GetClientReqTermList', { ClientReqID: tableRow.ClientReqID })
                .success(function (response) {
                    $scope.ReqTermDataSetupGridData = response.ClientReqTermList;
                    $scope.ReqTermGridDisplayCollection = [].concat($scope.ReqTermDataSetupGridData);
                    $scope.loading = false;
                }).error(function () {
                    $scope.loading = false;
                });

            $('#ClientInfoModal').modal('hide');
        };

        $scope.clearVendorCSInfo = function () {
            $scope.VendorCSInfo = {
                VendorCSAprvID: "",
                VendorID: "",
                VendorCode: "",
                VendorName: "",
                ContactPerson: "",
                ContactNumber: "",
                VendorTINNo: "",
                VendorBINNo: "",
                VendorAddress: "",
                RequisitionNo: "",
                SubmissionDate: "",
                RequisitionDate: "",
                Remarks: "",
                PoAmount:""
            }

            $scope.VendorCSInfoItem = {
                VendorCSInfoItemID: "",
                VendorCSInfoID: "",
                Description: "",
                DeliveryLocation: "",
                DeliveryDate: "",
                ServiceCategory: { ServiceCategoryID: "", ServiceCategoryName: "" },
                ServiceItem: { ServiceItemID: "", ServiceItemName: "" },
                DeliveryMode: "",
                ReqQnty: "",
                ReqUnit: ""
            }
            $scope.VendorCSInfoTerm = {
                VendorCSInfoTermsID: "",
                VendorCSInfoID: "",
                TermsID: "",
                TermsCode: "",
                TermsName: ""
            }
            $scope.VendorCSVendorsItemWise = {
                VendorCSInfoID: "",
                VendorID: "",
                VendorName: "",
                TransactionName: "",
                VendorCSInfoItemID: "",
                ContactPerson: "",
                ContactNumber: "",
                VendorQutnID: "",
                VendorQutnNo: "",
                QuotationDate: "",
                TolQnty: "",
                VenReqUnit: "",
                Status: ""
            }

            $("#DeliveryDate").val('');
            $scope.VenCSItemList = [];  // base collection
            $scope.VenCSItemGridDisplayCollection = [].concat($scope.VenCSItemList);

            $scope.ReqTermDataSetupGridData = [];  // base collection
            $scope.ReqTermGridDisplayCollection = [].concat($scope.ReqTermDataSetupGridData);

            $scope.ReqWiseVendorList = [];  // base collection
            $scope.VendorInfoDisplayedCollection = [].concat($scope.ReqWiseVendorList);
        }

        $scope.toggleReqItemEdit = function (tableRow, $i) {
            $('#RequisitionItemModal').modal('show');
            $scope.resetVendorCSInfoItem();

            $scope.VendorCSInfoItem.VendorCSInfoItemID = tableRow.VendorCSInfoItemID;

            $scope.VendorCSInfoItem.ServiceCategory.ServiceCategoryID = tableRow.ServiceCategoryID;
            $scope.VendorCSInfoItem.ServiceCategory.ServiceCategoryName = tableRow.ServiceCategoryName;
            $scope.VendorCSInfoItem.ServiceItem.ServiceItemID = tableRow.ServiceItemID;
            $scope.VendorCSInfoItem.ServiceItem.ServiceItemName = tableRow.ServiceItemName;

            $scope.VendorCSInfoItem.DeliveryMode = tableRow.DeliveryMode;
            $scope.VendorCSInfoItem.DeliveryLocation = tableRow.DeliveryLocation;
            $scope.VendorCSInfoItem.DeliveryDate = tableRow.DeliveryDate;
            $scope.VendorCSInfoItem.Description = tableRow.Description;

            $scope.VendorCSInfoItem.ReqQnty = tableRow.ReqQnty;
            $scope.VendorCSInfoItem.ReqUnit = tableRow.ReqUnit;

            $scope.VenCSItemGridDisplayCollection.splice($i, 1);
            $scope.vendorCSItemArray.splice($i, 1);

            $http.post("/ServiceItemInfo/GetServiceItemInfoSearchList?ServiceItemCategoryID=" + tableRow.ServiceCategoryID)
                .success(function (response) {
                    $scope.loading = false;
                    $scope.serviceItems = response.ServiceItemInfoSearchList;
                })
                .error(function () { });

            $("#btnAddReqItem").html('Update');
        };

        $scope.toggleReqItemDelete = function (tableRow, $i) {
            if (!tableRow.VendorCSInfoItemID) {
                $scope.resetVendorCSInfoItem();
                $scope.VenCSItemGridDisplayCollection.splice($i, 1);
                $scope.vendorCSItemArray.splice($i, 1);
                toastr.success('Data Deleted Successsfully');
            }
            else {
                $scope.resetVendorCSInfoItem();
                $scope.VendorCSInfoItem.VendorCSInfoItemID = tableRow.VendorCSInfoItemID;
                $('#deleteReqItemModal').modal('show');
            }
        };

        $scope.DeleteVendorCSInfoItem = function () {
            $http.post('/VendorCSInfo/DeleteVendorCSInfoItemAndTerm',
                { VendorCSInfoItemID: $scope.VendorCSInfoItem.VendorCSInfoItemID, VendorCSInfoTermID: $scope.VendorCSInfoTerm.VendorCSInfoTermID })
                .success(function (response) {
                    if (response.status == "S203") {
                        $scope.resetVendorCSInfoItem();
                        $scope.VenCSItemGridDisplayCollection.splice($i, 1);
                        $scope.vendorCSItemArray.splice($i, 1);
                        toastr.success('Data Deleted Successsfully');
                        return;
                    }
                });
        }

        ////////////////////////Select for Update from Search grid ///////////////////////
        $scope.toggleVendorWiseItemReqDelete = function (tableRow, $i) {
            if (!tableRow.VendorCSInfoItemWiseID) {
                $scope.resetVendorWiseItemReq();
                $scope.VendorInfoDisplayedCollection.splice($i, 1);
                //$scope.vendorCSItemArray.splice($i, 1);
                toastr.success('Data Deleted Successsfully');
            }
            else {
                $scope.resetVendorWiseItemReq();
                $scope.VendorCSVendorsItemWise.VendorCSInfoItemWiseID = tableRow.VendorCSInfoItemWiseID;
                $('#deleteReqItemModal').modal('show');
            }
        };

        $scope.toggleVendorSelect = function (row) {

            $scope.VendorCSInfo.VendorID = row.VendorID;
            $scope.VendorCSInfo.VendorCode = row.VendorCode;
            $scope.VendorCSInfo.VendorName = row.VendorName;

            $scope.VendorCSVendorsItemWise.VendorID = row.VendorID;
            $scope.VendorCSVendorsItemWise.VendorName = row.VendorName;
            $scope.VendorCSVendorsItemWise.TransactionName = row.TransactionName;
            $scope.VendorCSVendorsItemWise.ContactPerson = row.ContactPerson;
            $scope.VendorCSVendorsItemWise.ContactNumber = row.ContactNumber;
            $scope.VendorCSVendorsItemWise.Email = row.Email;
            $scope.VendorCSVendorsItemWise.Address = row.Address;

            $scope.VendorInfoDisplayedCollection = $scope.VendorInfoDisplayedCollection.concat($scope.VendorCSVendorsItemWise);

            $scope.resetVendorWiseItemReq();

            $('#VendorInfoModal').modal('hide');
        };

        ////////////////////////////////////

        $scope.selectedRowsForVendor = [];
        $scope.SelectedVendorForBiddingDisplayedCollection = [];
        $scope.showVendorforBiddingArea = false;

        $scope.selectEntity = function (row) {
            // Check if the row is already selected
            if (row.selected) {
                // Unselect the row
                row.selected = false;
                row.buttonCheckedforVendor = false;
                $scope.selectedRowsForVendor = [];
                $scope.SelectedVendorForBiddingDisplayedCollection = [];
                $scope.VenCSItemList = [];
                $scope.VenCSItemGridDisplayCollection = [];
                $scope.ReqTermDataSetupGridData = [];
                $scope.ReqTermGridDisplayCollection = [];
                $scope.showVendorforBiddingArea = false;
                return;
            }

            // If not already selected, proceed with selection
            // Deselect all other rows
            $scope.CSVendorDisplayedCollection.forEach(function (item) {
                item.selected = false;
                item.buttonCheckedforVendor = false;
            });

            // Clear previous selections
            $scope.selectedRowsForVendor = [];
            $scope.SelectedVendorForBiddingDisplayedCollection = [];
            $scope.VenCSItemList = [];
            $scope.VenCSItemGridDisplayCollection = [];
            $scope.ReqTermDataSetupGridData = [];
            $scope.ReqTermGridDisplayCollection = [];

            var selecteditems = {
                VendorID: row.VendorID,
                VendorName: row.VendorName,
                ContactPerson: row.ContactPerson,
                ContactNumber: row.ContactNumber,
                index: row.index
            };

            $scope.selectedRowsForVendor.push(selecteditems);
            $scope.SelectedVendorForBiddingDisplayedCollection = [].concat($scope.selectedRowsForVendor);
            row.selected = true;
            row.buttonCheckedforVendor = true;
            $scope.showVendorforBiddingArea = true;
            $scope.VendorCSInfo.WIInfoID = row.WIInfoID;
            $http.post("/POCreation/GetVendorPOQuotationItem", {
                VendorID: row.VendorID,
                ClientReqID: row.ClientReqID,
                WIInfoID:row.WIInfoID
            })
                .success(function (response) {
                    $scope.VenCSItemList = response.VenCSItemList.map(function (item) {
                        item.NegoTolAmt = parseFloat(item.NegoTolAmt).toFixed(2);  // Format NegoTolAmt
                        item.NegoAmt = parseFloat(item.NegoAmt).toFixed(2);
                        item.QutnQnty = parseFloat(item.QutnQnty).toFixed(2);
                      
                        return item;
                    });
                    $scope.VenCSItemGridDisplayCollection = [].concat($scope.VenCSItemList);
                    console.log($scope.VenCSItemGridDisplayCollection);
                })
                .error(function () {
                    $scope.loading = false;
                });

            $http.post('/POCreation/GetVendorPOInfoTermList', {
                VendorID: row.VendorID,
                ClientReqID: row.ClientReqID,
                WIInfoID: row.WIInfoID
            })
                .success(function (response) {
                    $scope.ReqTermDataSetupGridData = response.VendorCSInfoTermList;
                    $scope.ReqTermGridDisplayCollection = [].concat($scope.ReqTermDataSetupGridData);
                    $scope.loading = false;
                })
                .error(function () {
                    $scope.loading = false;
                });
        };
        $scope.resetVendorWiseItemReq = function () {
            $scope.VendorCSVendorsItemWise = {
                VendorCSInfoID: "",
                VendorID: "",
                VendorName: "",
                TransactionName: "",
                VendorCSInfoItemID: "",
                ContactPerson: "",
                ContactNumber: "",
                VendorTINNo: "",
                VendorBINNo: "",
                VendorEmail: "",
                VendorAddress: "",
                VenReqQnty: "",
                VenReqUnit: "",
                Status: ""
            }
        }

        ///////////////////////Save/Update Master///////////////////////

        //////////////////Search Grid List///////////////////////////////

        $scope.SearchVendorCSInfoModal = function () {
            $scope.GetVendorCSInfoSearchList();
            $('#SearchVendorCSInfoModal').modal('show');
        };

        $scope.GetVendorCSInfoSearchList = function () {
            $http.post("/VendorCSInfo/GetVendorCSInfoSearchList")
                .success(function (response) {
                    $scope.vendorCSSearchList = response.vendorCSSearchList;
                    $scope.vendorCSDisplayedCollection = [].concat($scope.vendorCSSearchList);
                })
                .error(function () { });
        }

        ////////////////////////Select for Update from Search grid ///////////////////////

        $scope.toggleVendorCSInfoSelect = function (tableRow) {
            $scope.VendorCSInfo.VendorCSInfoID = tableRow.VendorCSInfoID;
            $scope.VendorCSInfo.ClientID = tableRow.ClientID;
            $scope.VendorCSInfo.ClientName = tableRow.ClientName;
            $scope.VendorCSInfo.VendorID = tableRow.VendorID;
            $scope.VendorCSInfo.VendorName = tableRow.VendorName;
            $scope.VendorCSInfo.RequisitionNo = tableRow.RequisitionNo;
            $scope.VendorCSInfo.RequisitionDate = tableRow.RequisitionDate;
            $scope.VendorCSInfo.SubmissionDate = tableRow.SubmissionDate;
            $scope.VendorCSInfo.LastDateofQuotation = tableRow.LastDateofQuotation;
            $scope.VendorCSInfo.Remarks = tableRow.Remarks;
            $scope.VendorCSInfo.Status = tableRow.Status;

            $http.post('/VendorCSInfo/GetVendorCSInfoItemList', { VendorCSInfoID: tableRow.VendorCSInfoID })
                .success(function (response) {
                    $scope.VenCSItemList = response.VendorCSInfoItemList;
                    $scope.VenCSItemGridDisplayCollection = [].concat($scope.VenCSItemList);
                    $scope.loading = false;
                }).error(function () {
                    $scope.loading = false;
                });

            $http.post('/VendorCSInfo/GetVendorCSInfoTermList', { VendorCSInfoID: tableRow.VendorCSInfoID })
                .success(function (response) {
                    $scope.ReqTermDataSetupGridData = response.VendorCSInfoTermList;
                    $scope.ReqTermGridDisplayCollection = [].concat($scope.ReqTermDataSetupGridData);
                    $scope.loading = false;
                }).error(function () {
                    $scope.loading = false;
                });

            $http.post('/VendorCSInfo/GetReqWiseVendorList', { VendorCSInfoID: tableRow.VendorCSInfoID })
                .success(function (response) {
                    $scope.ReqWiseVendorList = response.ReqWiseVendorList;
                    $scope.VendorInfoDisplayedCollection = [].concat($scope.ReqWiseVendorList);//VendorInfoDisplayedCollection
                    $scope.loading = false;
                })
                .error(function () { });


            $('#SearchVendorCSInfoModal').modal('hide');
        };

        ///////////////////////////////////////////////

        ////////////////////////Requsition Terms & Conditions ///////////////////////

        $scope.ShowTermsConditionsList = function () {
            $http.get("/VendorCSInfo/GetTermsConditionsList")
                .success(function (response) {
                    $scope.TermsConditionsList = response.termsConditionsList;
                    $scope.TermsConditionsDisplayedCollection = [].concat($scope.TermsConditionsList);
                    $scope.loading = false;
                })
                .error(function () { });

            $('#VendorCSInfoTermsConditionsModal').modal('show');
        };

        $scope.toggleTermsConditionsSelect = function (row) {
            $scope.VendorCSInfo.TermsID = row.TermsID;
            $scope.VendorCSInfo.FormName = row.FormName;

            $http.post('/VendorCSInfo/GetVendorCSInfoTermAgainstFormList', { TermsID: row.TermsID })
                .success(function (response) {
                    $scope.ReqTermDataSetupGridData = response.VendorCSInfoTermList;
                    $scope.ReqTermGridDisplayCollection = [].concat($scope.ReqTermDataSetupGridData);
                    $scope.loading = false;
                }).error(function () {
                    $scope.loading = false;
                });

            $('#VendorCSInfoTermsConditionsModal').modal('hide');
        };

        $scope.VendorCSInfoTerm = {
            VendorCSInfoTermsID: "",
            VendorCSInfoID: "",
            TermsID: "",
            TermsCode: "",
            TermsName: ""
        }

        $scope.AddReqTermModal = function () {

            if ($('#RequisitionNo').val() == "") {
                toastr.error("Vendor ReqNo.  Required");
                return;
            }

            if ($('#SubmissionDate').val() == "") {
                toastr.error("Submission Date Required.");
                return;
            }

            if ($('#RequisitionDate').val() == "") {
                toastr.error("Requisition Date Date Required");
                return;
            }
            $('#RequisitionTermModal').modal('show');
        };

        $scope.ReqTermDataSetupGridData = [];  // base collection
        $scope.ReqTermGridDisplayCollection = [].concat($scope.ReqTermDataSetupGridData);

        $scope.AddReqTerm = function () {

            if ($('#TermsCode').val() == "") {
                toastr.error("Terms Code Required");
                return;
            }

            if ($('#TermsName').val() == "") {
                toastr.error("Terms Name Required.");
                return;
            }

            $scope.VendorCSInfoTerm.TermsCode = $('#TermsCode').val();
            $scope.VendorCSInfoTerm.TermsName = $('#TermsName').val();

            $scope.vendorCSTermArray.push($scope.VendorCSInfoTerm);

            $scope.ReqTermGridDisplayCollection = $scope.ReqTermGridDisplayCollection.concat($scope.VendorCSInfoTerm);

            $scope.resetVendorCSInfoTerm();
            $("#btnAddReqTerm").html('Add');
            $('#RequisitionTermModal').modal('hide');
        }

        $scope.resetVendorCSInfoTerm = function () {
            $scope.VendorCSInfoTerm = {
                VendorCSInfoTermsID: "",
                VendorCSInfoID: "",
                TermsID: "",
                TermsCode: "",
                TermsName: ""
            }
        }

        $scope.toggleReqTermEdit = function (tableRow, $i) {
            $('#RequisitionTermModal').modal('show');
            $scope.resetVendorCSInfoTerm();
            $scope.VendorCSInfoTerm.VendorCSInfoTermID = tableRow.VendorCSInfoTermD;
            $scope.VendorCSInfoTerm.VendorCSInfoID = tableRow.VendorCSInfoID;
            $scope.VendorCSInfoTerm.TermsID = tableRow.TermsID;
            $scope.VendorCSInfoTerm.TermsCode = tableRow.TermsCode;
            $scope.VendorCSInfoTerm.TermsName = tableRow.TermsName;
            $scope.ReqTermGridDisplayCollection.splice($i, 1);
            $scope.vendorCSTermArray.splice($i, 1);
            $("#btnAddReqTerm").html('Update');
        };

        $scope.toggleReqTermDelete = function (tableRow, $i) {
            if (!tableRow.VendorCSInfoTermID) {
                $scope.resetVendorCSInfoTerm();
                $scope.ReqTermGridDisplayCollection.splice($i, 1);
                $scope.vendorCSTermArray.splice($i, 1);
                toastr.success('Data Deleted Successsfully');
            }
            else {
                $scope.resetVendorCSInfoTerm();
                $scope.VendorCSInfoTerm.VendorCSInfoTermID = tableRow.VendorCSInfoTermID;
                $('#deleteReqTermModal').modal('show');
            }
        };

        $scope.DeleteVendorCSInfoTerm = function () {
            $http.post('/VendorCSInfo/DeleteVendorCSInfoItemAndTerm',
                { VendorCSInfoItemID: $scope.VendorCSInfoItem.VendorCSInfoItemID, VendorCSInfoTermID: $scope.VendorCSInfoTerm.VendorCSInfoTermID })
                .success(function (response) {
                    if (response.status == "S203") {
                        $scope.resetVendorCSInfoTerm();
                        $scope.ReqTermGridDisplayCollection.splice($i, 1);
                        $scope.vendorCSTermArray.splice($i, 1);
                        toastr.success('Data Deleted Successsfully');
                        return;
                    }
                });
        }

        ///////////////////////////////////////////////

        $scope.Post = function () {

            if ($('#RequisitionNo').val() == "") {
                toastr.error("Vendor ReqNo.  Required");
                return;
            }

            if ($('#SubmissionDate').val() == "") {
                toastr.error("Submission Date Required.");
                return;
            }

            if ($('#RequisitionDate').val() == "") {
                toastr.error("Requisition Date Date Required");
                return;
            }

            $scope.VendorCSInfo.RequisitionDate = $('#RequisitionDate').val();
            $scope.VendorCSInfo.SubmissionDate = $('#SubmissionDate').val();
            $scope.VendorCSInfo.CSRecDate = $('#CSRecDate').val();
            $http.post('/POCreation/SaveVendorPOInfo',
                {
                    vendorCS: $scope.VendorCSInfo,
                    vendorCSItem: $scope.VenCSItemGridDisplayCollection,
                    vendorCSTerm: $scope.ReqTermGridDisplayCollection,
                    vendorCSItemWise: $scope.SelectedVendorForBiddingDisplayedCollection
                })
                .success(function (response) {
                    if (response.status == "S201") {
                        toastr.success("Data Saved Successfully.");
                        $scope.clearVendorCSInfo();
                        $scope.toggleRefreshTable();
                        $scope.loading = false;
                        return;
                    }
                    else if (response.status == "S202") {
                        toastr.success("Data Updated Successfully.");
                        $scope.clearVendorCSInfo();
                        $scope.loading = false;
                        return;
                    }
                    else if (response.status == "S203") {
                        toastr.success("Data Deleted Successfully.");
                        $scope.clearVendorCSInfo();

                        $scope.loading = false;
                        return;
                    }
                    else {
                        toastr.error("Data Save Failed.");
                        $scope.loading = false;
                        return;
                    }
                })
                .error(function () {
                    toastr.error("Data Save Failed.");
                    $scope.loading = false;
                    return;
                });
        }



            //$scope.printData = function () {
            //    var VendorSlip = document.getElementById("masterRow");
            //    newWin = window.open("");
            //    newWin.document.write(VendorSlip.outerHTML);
            //    $timeout(newWin.print(), 0);
            //    newWin.close();
            //};

        //$scope.printData = function () {
        //    var VendorSlip = document.getElementById("masterRow");
        //    var newWin = window.open('', '_blank'); // Open a new window

        //    // Write HTML content to the new window
        //    newWin.document.write('<html><head><title>Print</title>');

        //    // Add custom styles for printing
        //    newWin.document.write('<style>' +
        //        'body { font-family: Arial, sans-serif; margin: 0; padding: 0; }' +
        //        'table { width: 100%; border-collapse: collapse; }' +
        //        'td, th { padding: 8px; text-align: left; border: 1px solid #ddd; }' +
        //        'p { margin: 0; font-size: 14px; }' + // Adjust as needed
        //        '.row { display: flex; justify-content: space-between; padding: 20px; }' +
        //        '.col-md-5, .col-md-4 { flex: 1; margin: 10px; }' + // Flex layout for columns
        //        'table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }' +
        //        '</style>');

        //    newWin.document.write('</head><body>');

        //    // Copy content from the original div and write it into the new window
        //    newWin.document.write(VendorSlip.outerHTML);

        //    newWin.document.write('</body></html>');

        //    // Wait for the document to be fully written before printing
        //    $timeout(function () {
        //        newWin.document.close(); // Close the document stream to ensure printing works
        //        newWin.print(); // Open the print dialog
        //        newWin.close(); // Close the new window after printing
        //    }, 500); // Timeout to ensure content is loaded
        //};


        //$scope.validateNegoQty = function (row) {
        //    if (row.NegoQty > row.RemainingQuantity) {
        //        toastr.error('Negotiation Quantity cannot exceed Remaining Quantity.');
        //        row.NegoQty = row.RemainingQty;
        //    } else if (row.NegoQty > row.QutnQnty) {
        //        alert('Negotiation Quantity cannot exceed Quotation Quantity.');
        //        row.NegoQty = row.QutnQnty;
        //    }
        //    $scope.checkUnitPrice(row); // Call the existing function
        //};



        $scope.checkUnitPrice = function (row) {
            var QutnAmt = 0;
            QutnAmt = (row.NegoQty * row.NegoPrice);
            row.NegoAmt = QutnAmt;
            $scope.checkVatPerc(row);
        };

        $scope.checkVatPerc = function (row) {
            var VatAmt = 0;
            VatAmt = (row.VatPerc * row.NegoAmt) / 100;
            row.NegoVatAmt = VatAmt;

            row.NegoTolAmt = row.NegoAmt + row.NegoVatAmt;
        };



        $scope.SearchPO = function () {
       
            $http.post('/POCreation/SearchPO',



                )

                    .success(function (response) {
                        $scope.SearchPOList = response.SearchPOList;
                        $scope.SearchPOListCollection = [].concat($scope.SearchPOList);
                        console.log($scope.SearchPOListCollection);
                        $scope.loading = false;
                    }).error(function () {
                        $scope.loading = false;
                    });

                $('#SearchModal').modal('show');
            } 
        



        $scope.calculateInstallmentAmount = function () {
            if ($scope.VendorCSInfo.PoAmount && $scope.VendorCSInfo.Installment) {
                // Calculate and set the InstalledAmount
                $scope.VendorCSInfo.InstalledAmount = parseFloat($scope.VendorCSInfo.PoAmount) / parseInt($scope.VendorCSInfo.Installment);
            }
        };






        $scope.toggleRefreshTable = function () {

            $timeout(function () {
                // Reload the current page
                window.location.reload();
            }, 2000);

        };
    }])
</script>

